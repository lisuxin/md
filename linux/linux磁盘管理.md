[toc]

# 磁盘管理，进程管理

## 命令

### fidsk命令

1. 查看磁盘分区表
   * 使用 `fdisk -l` 查看系统中的所有磁盘及其分区信息。
   * 从 Linux 内核 2.17 开始，推荐使用 `lsblk` 或 `parted` 查看磁盘信息，因为它们输出更清晰。
2. 进入交互模式
   * `fdisk /dev/sdX`其中/dev/sdX 是目标磁盘设备名称
   * fdisk 交互模式常用命令
      * `m`	显示帮助菜单，列出所有可用命令。
      * `p`	打印当前磁盘的分区表。
      * `n`	创建新分区。
      * `d`	删除现有分区。
      * `t`	更改分区类型（例如设置为 Linux 文件系统或交换分区）。
      * `l`	列出所有可用的分区类型。
      * `w`	写入更改并退出。
      * `q`	不保存更改直接退出。
3. 创建新分区
   - 输入 `n` 创建新分区。
   - 选择分区类型（`p` 表示主分区，`e` 表示扩展分区）。
   - 指定分区号（如果自动分配则回车）。
   - 设置起始扇区（默认即可）。
   - 设置结束扇区或大小（例如 `+1G` 表示创建 1GB 的分区）。
4. 删除分区
   - 输入 `d` 删除分区。
   - 输入要删除的分区号。
5. 更改分区类型
   - 输入 `t` 更改分区类型。
   - 输入要修改的分区号。
   - 输入新的分区类型代码（例如 `83` 表示 Linux 文件系统，`82` 表示交换分区）。
6. 写入更改
   - 输入 `w` 将更改写入磁盘并退出。
   - 如果不想保存更改，可以输入 `q` 退出。
7. 注意事项
   1. 备份数据:在对磁盘进行分区操作前，请确保重要数据已备份，避免误操作导致数据丢失。
   2. 分区表类型
      * `msdos`：传统的 MBR 分区表，最多支持 4 个主分区。
      * `gpt`：GUID 分区表，支持更多分区和更大的磁盘容量。
      * 可以通过 `g` 命令将分区表类型转换为 GPT。
   3. 刷新分区表：如果分区表被修改但未生效，可以使用以下命令刷新内核分区表：`partprobe /dev/sdX`

### df命令

* 使用 df 命令可以查看硬盘的使用情况

   * 语法： `df [-h]`
   * 选顶： -h, 以更加人性化的单位显示
      * `-H`	类似于 -h，但使用 1000 而不是 1024 作为单位换算基数。
      * `-T`	显示文件系统类型（例如 ext4、xfs、tmpfs 等）。
      * `-i`	显示 inode（索引节点）的使用情况，而不是磁盘空间。
      * `-t <type>`	仅显示指定类型的文件系统（例如 -t ext4）。
      * `-x <type>`	排除指定类型的文件系统（例如 -x tmpfs）。
      * `--output`	自定义输出列（例如 --output=source,size,used,avail,pcent）。
* 使用 iostat 查看 CPU 、磁盘的相关信息

   * 语法： `iostat [-x] [num1] [num2]`

   * 选项：-x，显示更多信息
   * num1: 数字，刷新间隔， num2: 数字，刷新几次

### partprobe 命令

* `partprobe` 是 Linux 系统中的一个命令，用于通知内核重新读取分区表信息。当磁盘分区表被修改，未自动更新到内核时，可以使用 `partprobe` 来刷新分区表，而无需重启系统。
* 基本语法`partprobe [选项] [设备]`
* 常用选项
   * `-d`	不尝试重新读取分区表，仅输出设备信息。
   * `-s`	显示设备及其分区的详细信息。
   * `-h`	显示帮助信息。
   * `-v`	显示详细的操作过程信息。

### partx 命令

* `partx` 是 Linux 系统中用于管理分区设备节点的命令，主要用于添加、删除或列出分区表中的分区设备节点。它通常在需要动态加载或卸载分区时使用，尤其是在通过工具（如 `fdisk` 或 `sgdisk`）修改磁盘分区后，`partx` 可以帮助内核识别新的分区。
* 基本语法：`partx [选项] [设备]`
* 常用选项
   * `-a`	添加所有分区到内核中（即创建对应的设备节点）。
   * `-d`	删除指定的分区设备节点。
   * `-r`	列出分区信息，并以可读格式输出。
   * `-g`	列出分区信息，并以脚本友好的格式输出（适合解析）。
   * `-l`	列出分区号及其范围。
   * `-n`	指定要操作的分区号（例如 -n 1 表示操作第一个分区）。
   * `--show`	显示分区信息而不进行任何更改。
   * `-v`	显示详细的操作过程信息。

## 磁盘管理

1. 磁盘管理的名词解释
   * 扇区 sector 是磁盘中最小的物理存储单元，单位 512 字节 512 bytes
   * 操作系统无法对数目众多的扇区进行寻址，因此操作系统将相邻的扇区组合在了一起，形成了块 block 。
   * 在 Linux 文件系统中多个连续的扇区，被称之为 btock ，块的概念，也是在系统中被认为是最小的存储单位操作系统规定，一个 block 只能存放一个文件的内容，因此文件占用的空间大小，只能是 block 的整数倍即使文件大小，小于一个块，也就是小于 4k ，同样的占用一个 block 大小
   * 分区编辑器，`partiion` 、`editor`
   * `fdisk` 对磁盘进行格式化的命令，以及分区等
2. 分区表 `mbr`、`gpt`
   * mbr 分区表
      * master boot record ，主分区引导记录
      * mbr 分区关注的是，硬盘容量受限制，最大 2T
   * gpt 分区表
      * 现在大多的硬盘分区表，都是 gpt 分区表了
      * 优点
      * gpt 分区表硬盘容量没有限制
      * 分区个数没有限制
      * 自带磁盘保
3. 常见的文件系统
   * fat16 fat32，最早的 windos 的文件系统，缺点是单个文件，不能超过 2GB
   * NTFS 文件系统，支持文件加，采用日志形式的文件系统，详细的记录磁盘读写的操作，支持数据恢复，能够提高磁数据的安全性，突破了单个文件 4G 大小的限制
   * exFAT文件系统，新式的文件系统，单个文件支持 16GB 大小，能够在 windows 和 Linux, macos 中同时识别
4. 磁盘的 RPM ，硬盘内电机主轴的旋转速度，也就是硬盘盘片在一分钟内能够完成的最大旋转数。
5. 磁盘性能检测
   * `input/output`、`operations`、`per`、`second` 这个值越大，代表磁盘性能越高
6. ide 硬盘，会被 Linux 识别为`/dev/hda /dev/hdb /dev/hdc /dev/hdd`
7. 一个硬盘的结构如下：
   * 系统默认分区1~4留给了主分区和扩展分区
   * 主分区 1 `*`（星号代表是引导分区，引导分区装在这里）
   * 主分区 2
   * 主分区 3
      * 逻辑分区 n

### 磁盘分区

1. 查找全部磁盘

   ```shell
   fdisk -l |grep sd
   ```

2. 进入交互磁盘

   ```shell
   fdisk /dev/sdb
   # 添加分区
   n
   # 设置主分区或扩展分区(二选一)
   p # 主分区
   e # 扩展分区
   # 输入区号，默认1
   1
   # 设置起始扇区，默认2048
   2048
   # 设置扇区大小
   +256m
   ```

3. 在没有进入`n`添加分区`p`为打印当前分区表

4. 将分区写入磁盘并退出`w`

5. 查看磁盘分区表号`cat /proc/partitions`

6. `partprobe` 命令centos5 或者以前使用此命令，可以用于重读分区表，当删除文件后，仍然占用磁盘空间，是因为磁盘分区表没更新，需要重启分区表，可以使用此命令，不重启电脑，重读分区表`partprobe /dev/sdb`：重读磁盘`/dev/sdb` 的分区表信息

7. `partx` 命令partx 命令用于告诉 linux 内核，新的磁盘分区情况，让内核重读分区表

8. 删除磁盘

### 针对超过2TB的磁盘分区

1. `parted`（只有主分区和扩展分区没有逻辑分区）

   

## 进程管理